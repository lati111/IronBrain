var o=Object.defineProperty;var h=(r,t,a)=>t in r?o(r,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[t]=a;var s=(r,t,a)=>(h(r,typeof t!="symbol"?t+"":t,a),a);import{g as p}from"./ajax-3bdbf024.js";class g{constructor(t,a){s(this,"dataProviderID");s(this,"dataHandler");s(this,"element");s(this,"dataUrl");s(this,"searchbar",null);s(this,"searchterm",null);s(this,"searchfields",null);s(this,"pagination",null);s(this,"perpage",10);s(this,"page",1);s(this,"filterlist",null);s(this,"filters",[]);this.dataProviderID=t,this.dataHandler=a;const e=document.querySelector("#"+t);if(e===null)return;this.element=e;const i=this.element.getAttribute("data-content-url");i!==null&&(this.dataUrl=i,this.loadStoredUrlData(!1),window.addEventListener("popstate",this.loadStoredUrlData.bind(this,!0)),this.dataHandler(this))}initSearchbar(t){if(this.searchbar=document.querySelector("#"+this.dataProviderID+"-searchbar"),this.searchbar!==null){const a=this.searchbar.getAttribute("data-searchfields")??"";this.searchfields=a,this.searchterm=t.searchParams.get("search")??"",this.searchbar.value=this.searchterm,this.searchbar.addEventListener("keydown",this.applySearchbar.bind(this));let e=this.searchbar.closest("div");if(e!==null&&(e=e.querySelector("button")),e===null){console.error("Malformed searchbar with ID "+this.dataProviderID);return}e.addEventListener("click",this.applySearchbar.bind(this))}}applySearchbar(t){if(this.searchbar===null||t instanceof KeyboardEvent&&t.key!==void 0&&t.key!=="Enter")return;const a=this.searchbar.value;a!==this.searchterm&&(this.page=1,this.searchterm=a,this.update())}async loadPagination(){if(this.pagination!==null){this.pagination.innerHTML="",this.page<=0&&(this.page=1);let t=0,a=this.pagination.getAttribute("data-url");if(a!==null){a+="?"+this.getUrl().toString().split("?");const e=await p(a);t=parseInt(e)}if(this.page!==1){const e=this.page-1;this.pagination.append(this.createPaginationNode("<",e))}else this.pagination.append(this.createEmptyPaginationNode());if(this.page>8)this.pagination.append(this.createPaginationNode("1",1)),this.pagination.append(this.createPaginationDivider());else for(let e=this.page-7;e<this.page-5;e++)e>0?this.pagination.append(this.createPaginationNode(e.toString(),e)):this.pagination.append(this.createEmptyPaginationNode());for(let e=this.page-5;e<this.page;e++)e>0?this.pagination.append(this.createPaginationNode(e.toString(),e)):this.pagination.append(this.createEmptyPaginationNode());this.pagination.append(this.createPaginationNode(this.page.toString(),this.page,!0));for(let e=this.page+1;e<this.page+6;e++)e<=t?this.pagination.append(this.createPaginationNode(e.toString(),e)):this.pagination.append(this.createEmptyPaginationNode());if(this.page<t-7)this.pagination.append(this.createPaginationDivider()),this.pagination.append(this.createPaginationNode(t.toString(),t));else for(let e=t-1;e<t+1;e++)e<t-2&&e>this.page?this.pagination.append(this.createPaginationNode(e.toString(),e)):this.pagination.append(this.createEmptyPaginationNode());if(this.page!==t){const e=this.page+1;this.pagination.append(this.createPaginationNode(">",e))}else this.pagination.append(this.createEmptyPaginationNode())}}applyPagination(t){this.page=t,this.update()}createPaginationNode(t,a,e=!1){const i=document.createElement("button");return i.classList.add("w-4"),i.classList.add("interactive"),i.classList.add("text-center"),i.textContent=t,e&&i.classList.add("active"),i.addEventListener("click",this.applyPagination.bind(this,a)),i}createPaginationDivider(){const t=document.createElement("span");return t.classList.add("w-4"),t.classList.add("primary-red"),t.textContent="...",t}createEmptyPaginationNode(){const t=document.createElement("button");return t.classList.add("w-4"),t}initFilters(){if(this.filterlist=document.querySelector("#"+this.dataProviderID+"-filterlist"),this.filterlist!==null){const t=this.filterlist.querySelector(".filter-container");new MutationObserver(this.applyFilters.bind(this)).observe(t,{characterData:!1,childList:!0,attributes:!1})}}applyFilters(){if(this.filterlist===null)return;this.filters=[];const t=this.filterlist.querySelectorAll(".filter");for(const a of t){const e={filter:a.getAttribute("data-filter"),operator:a.getAttribute("data-operator"),value:a.getAttribute("data-value")};this.filters.push(e)}this.update()}getElement(){return this.element}getUrl(){const t=new URL(this.dataUrl);return this.pagination!==null&&(t.searchParams.set("page",""+this.page),t.searchParams.set("perpage",""+this.perpage)),this.searchbar!==null&&t.searchParams.set("search",""+this.searchterm),this.filterlist!==null&&t.searchParams.set("filters",JSON.stringify(this.filters)),t}update(t=!1){if(t===!1){let a=new URL(window.location.href);const e=this.getUrl().toString().split("?")[1];a.searchParams.set(this.dataProviderID,e),window.history.pushState({urlPath:a.toString()},"",a.toString())}this.dataHandler(this)}loadStoredUrlData(t=!1){let e=new URL(window.location.href).searchParams.get(this.dataProviderID)??"";e!==""&&(e="?"+e);const i=new URL(this.dataUrl+e);this.initSearchbar(i),this.pagination=document.querySelector("#"+this.dataProviderID+"-pagination");const n=i.searchParams.get("perpage")??"6";this.perpage=parseInt(n);const l=i.searchParams.get("page")??"1";this.page=parseInt(l),this.loadPagination(),this.initFilters(),t===!0&&this.update(t)}}export{g as D};
